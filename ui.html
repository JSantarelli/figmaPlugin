<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design Review</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 10px;
      background-color: #f5f5f5;
    }

    h2 {
      margin: 0 0 10px;
      font-size: 18px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background-color: #45a049;
    }

    .issues-container {
      margin-top: 20px;
      max-height: 500px;
      overflow-y: auto;
      background: white;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }

    .issue-item {
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
      cursor: pointer;
    }

    .issue-item:hover {
      background-color: #e6f7ff;
      border-color: #91d5ff;
    }
    #addLandmark {
      background-color: #FFEB3B; /* Yellow background for landmark button */
      color: black;
      margin-top: 10px;
    }

    #addLandmark:hover {
      background-color: #FFDD00; /* Darker yellow on hover */
    }
    
    #plugin-logo {
      width: 100px; /* Adjust width as needed */
      height: auto;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <h2>Design Spacing Review</h2>
  <div id="logo-container">
    <img src="./assets/img/alloy__logo.png" alt="Plugin Logo" id="plugin-logo" />
  </div>
  <button id="runReview">Run Review</button>
  <button id="addLandmark" style="margin-top: 20px;">Add Accessibility Landmark</button>

  <div id="issuesContainer" class="issues-container" style="display: none;"></div>
  <div id="successMessage" class="success-message" style="display: none;">No issues found! ðŸŽ‰</div>

  <script>
    document.getElementById('runReview').addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'run-review' } }, '*');
    });

    document.getElementById('addLandmark').addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'add-landmark' } }, '*');
    });

    window.onmessage = (event) => {
      const message = event.data.pluginMessage;

      const issuesContainer = document.getElementById('issuesContainer');
      const successMessage = document.getElementById('successMessage');

      // Clear existing messages
      issuesContainer.style.display = 'none';
      successMessage.style.display = 'none';
      issuesContainer.innerHTML = '';

      if (message.type === 'show-groupedIssues') {
        const groupedIssues = message.grouped;

        if (groupedIssues.length === 0) {
          successMessage.style.display = 'block';
        } else {
          issuesContainer.style.display = 'block';

          groupedIssues.forEach((frame) => {
            const frameSection = document.createElement('div');

            const frameTitle = document.createElement('div');
            frameTitle.textContent = frame.frameName || 'Unnamed Frame';
            frameSection.appendChild(frameTitle);

            frame.groupedIssues.forEach((issue) => {
              const issueItem = document.createElement('div');
              issueItem.className = 'issue-item';

              let issueDescription = '';
              if (issue.type === 'padding') {
                issueDescription = `Padding Issue in "${issue.elementName}": Expected ${issue.expected}px ${issue.direction} padding, but found ${issue.spacing}px.`;
              } else if (issue.type === 'spacing') {
                issueDescription = `Spacing Issue in "${issue.elementName}": Expected ${issue.expected}px ${issue.direction} spacing, but found ${issue.spacing}px.`;
              } else if (issue.type === 'font-token') {
                issueDescription = `Font Token Issue in "${issue.elementName}": Expected "${issue.expected}" for ${issue.property}, but found "${issue.actual}".`;
              } else if (issue.type === 'color-token') {
                issueDescription = `Color Token Issue in "${issue.elementName}": Expected "${issue.expected}" for ${issue.property}, but found "${issue.actual}".`;
              } else {
                issueDescription = `Unknown issue type: ${issue.type}`;
              }

              issueItem.innerHTML = issueDescription;

              // Add hover events to send messages to the plugin
              issueItem.addEventListener('mouseenter', () => {
                parent.postMessage({ pluginMessage: { type: 'highlight-frame', frameId: issue.element.id } }, '*');
              });

              issueItem.addEventListener('mouseleave', () => {
                parent.postMessage({ pluginMessage: { type: 'reset-highlight', frameId: issue.element.id } }, '*');
              });

              frameSection.appendChild(issueItem);
            });

            issuesContainer.appendChild(frameSection);
          });
        }
      }
    };
  </script>
</body>
</html>
